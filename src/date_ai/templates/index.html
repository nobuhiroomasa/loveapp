<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>デート＆おでかけAI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <header>
      <h1>デート＆おでかけAI</h1>
      <p class="lead">
        気分や条件を入力すると、ぴったりのおでかけプランをおすすめします。
      </p>
    </header>

    <main>
      <section class="search">
        <form method="post">
          <div class="field">
            <label for="city">エリア<span class="required">*</span></label>
            <select id="city" name="city" required>
              <option value="">選択してください</option>
              {% for city in choices.cities %}
              <option value="{{ city }}" {% if form.city == city %}selected{% endif %}>{{ city }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="field-grid">
            <div class="field">
              <label for="budget">予算帯</label>
              <select id="budget" name="budget">
                <option value="">指定なし</option>
                {% for budget in choices.budgets %}
                <option value="{{ budget }}" {% if form.budget == budget %}selected{% endif %}>{{ budget }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="field">
              <label for="weather">想定天気</label>
              <select id="weather" name="weather">
                <option value="">指定なし</option>
                {% for weather in choices.weathers %}
                <option value="{{ weather }}" {% if form.weather == weather %}selected{% endif %}>{{ weather }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="field">
              <label for="mood">ムード</label>
              <select id="mood" name="mood">
                <option value="">指定なし</option>
                {% for mood in choices.moods %}
                <option value="{{ mood }}" {% if form.mood == mood %}selected{% endif %}>{{ mood }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="field">
              <label for="activity">アクティビティ</label>
              <select id="activity" name="activity_type">
                <option value="">指定なし</option>
                {% for activity in choices.activity_types %}
                <option value="{{ activity }}" {% if form.activity_type == activity %}selected{% endif %}>{{ activity }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="field-grid">
            <div class="field">
              <label for="max_duration_hours">最大時間 (時間)</label>
              <input
                type="number"
                id="max_duration_hours"
                name="max_duration_hours"
                min="1"
                max="24"
                value="{{ form.max_duration_hours if form.max_duration_hours is not none else '' }}"
              />
            </div>
            <div class="field">
              <label for="limit">表示件数</label>
              <input
                type="number"
                id="limit"
                name="limit"
                min="1"
                max="10"
                value="{{ form.limit }}"
                required
              />
            </div>
          </div>

          <div class="actions">
            <button type="submit">おすすめを表示</button>
          </div>
        </form>

        {% if message %}
        <p class="message">{{ message }}</p>
        {% endif %}
      </section>

      <section class="results">
        {% if recommendations %}
        <h2>おすすめプラン</h2>
        <div class="cards">
          {% for rec in recommendations %}
          <article class="card">
            <header>
              <h3>{{ rec.title }} <span class="city">({{ rec.city }})</span></h3>
              <p class="meta">
                スコア: {{ '%.1f' | format(rec.score) }} / 所要時間: 約{{ rec.duration_hours }}時間 / 予算: {{ rec.budget }}
              </p>
              <p class="meta secondary">
                ベストシーズン: {{ rec.ideal_season }} / おすすめ時間帯: {{ rec.ideal_time }} /
                予約: {{ '要予約' if rec.booking_required else '当日参加OK' }}
              </p>
            </header>
            <p class="description">{{ rec.description }}</p>
            <div class="highlights">
              <h4>ハイライト</h4>
              <ul>
                {% for highlight in rec.highlights %}
                <li>{{ highlight }}</li>
                {% endfor %}
              </ul>
            </div>
            {% if rec.tips %}
            <div class="tips">
              <h4>プランのコツ</h4>
              <ul>
                {% for tip in rec.tips %}
                <li>{{ tip }}</li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
            <div class="rationale">
              <h4>おすすめの理由</h4>
              <ul>
                {% for reason in rec.rationale %}
                <li>{{ reason }}</li>
                {% endfor %}
              </ul>
            </div>
            <footer class="tags">
              <span>#{{ rec.mood }}</span>
              <span>#{{ rec.activity_type }}</span>
              <span>#{{ rec.weather }}</span>
            </footer>
          </article>
          {% endfor %}
        </div>
        {% endif %}
      </section>
    </main>

    <footer>
      <small>Powered by Date &amp; Outing AI</small>
    </footer>
  </body>
</html>
